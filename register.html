<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Register - Tamil Nadu Blood Donor</title>

<!-- Firebase (compat) -->
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.12.0/firebase-database-compat.js"></script>

<style>
  :root {
    --primary: #1d3557;
    --primary-dark: #14213d;
    --primary-light: #457b9d;
    --secondary: #e63946;
    --secondary-dark: #c1121f;
    --secondary-light: #f8ad9d;
    --accent: #2a9d8f;
    --accent-dark: #21867a;
    --light: #f1faee;
    --white: #ffffff;
    --gray: #6c757d;
    --gray-light: #e9ecef;
    --gray-dark: #495057;
    --shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
    --shadow-lg: 0 10px 25px rgba(0, 0, 0, 0.1);
    --radius: 10px;
    --transition: all 0.3s ease;
  }

  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
  }

  body {
    font-family: 'Inter', 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    color: #333;
    line-height: 1.6;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
  }

  header {
    background: var(--primary);
    color: var(--white);
    padding: 1.5rem 1rem;
    text-align: center;
    font-weight: 700;
    font-size: 1.5rem;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    position: relative;
  }

  header::after {
    content: "";
    position: absolute;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 4px;
    background: linear-gradient(90deg, var(--primary), var(--accent), var(--secondary));
  }

  .logo {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    margin-bottom: 0.5rem;
  }

  .logo-icon {
    font-size: 1.75rem;
  }

  .container {
    max-width: 900px;
    margin: 2rem auto;
    background: var(--white);
    padding: 2.5rem;
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg);
    flex: 1;
  }

  @media (max-width: 768px) {
    .container {
      margin: 1rem;
      padding: 1.5rem;
    }
  }

  .form-header {
    margin-bottom: 2rem;
    text-align: center;
  }

  .form-header h1 {
    color: var(--primary);
    font-size: 2rem;
    margin-bottom: 0.5rem;
    font-weight: 700;
  }

  .form-header p {
    color: var(--gray);
    font-size: 1.1rem;
    max-width: 600px;
    margin: 0 auto;
  }

  form {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1.5rem;
  }

  @media (max-width: 768px) {
    form {
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }
  }

  .form-group {
    display: flex;
    flex-direction: column;
  }

  .form-group.full-width {
    grid-column: 1 / -1;
  }

  label {
    font-weight: 600;
    margin-bottom: 0.5rem;
    color: var(--primary);
    font-size: 0.95rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .required::after {
    content: " *";
    color: var(--secondary);
  }

  input, select {
    padding: 0.875rem 1rem;
    border-radius: var(--radius);
    border: 1.5px solid var(--gray-light);
    font-size: 1rem;
    transition: var(--transition);
    background-color: var(--white);
    font-family: inherit;
  }

  input:focus, select:focus {
    outline: none;
    border-color: var(--primary);
    box-shadow: 0 0 0 3px rgba(29, 53, 87, 0.15);
    transform: translateY(-2px);
  }

  button {
    padding: 1rem 2rem;
    border-radius: var(--radius);
    border: none;
    font-size: 1.1rem;
    font-weight: 600;
    cursor: pointer;
    transition: var(--transition);
    background: linear-gradient(135deg, var(--primary), var(--primary-dark));
    color: var(--white);
    grid-column: 1 / -1;
    margin-top: 1rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    box-shadow: 0 4px 12px rgba(29, 53, 87, 0.2);
  }

  button:hover {
    background: linear-gradient(135deg, var(--primary-dark), var(--primary));
    transform: translateY(-3px);
    box-shadow: 0 6px 15px rgba(29, 53, 87, 0.25);
  }

  button:active {
    transform: translateY(-1px);
  }

  button:disabled {
    background: var(--gray);
    cursor: not-allowed;
    transform: none;
    box-shadow: none;
  }

  .links {
    margin-top: 2rem;
    display: flex;
    justify-content: center;
  }

  .links a {
    color: var(--primary);
    text-decoration: none;
    font-weight: 600;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius);
    transition: var(--transition);
    display: flex;
    align-items: center;
    gap: 0.75rem;
    border: 1.5px solid var(--primary);
  }

  .links a:hover {
    background-color: var(--primary);
    color: var(--white);
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(29, 53, 87, 0.15);
  }

  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    padding: 1.25rem 1.75rem;
    border-radius: var(--radius);
    background: var(--primary);
    color: var(--white);
    box-shadow: var(--shadow-lg);
    transform: translateX(150%);
    transition: transform 0.4s ease;
    z-index: 1000;
    max-width: 400px;
    display: flex;
    align-items: center;
    gap: 0.75rem;
  }

  .notification.show {
    transform: translateX(0);
  }

  .notification.success {
    background: linear-gradient(135deg, var(--accent), var(--accent-dark));
  }

  .notification.error {
    background: linear-gradient(135deg, var(--secondary), var(--secondary-dark));
  }

  .notification-icon {
    font-size: 1.25rem;
  }

  footer {
    background: var(--primary);
    color: var(--white);
    text-align: center;
    padding: 1.5rem;
    margin-top: 2rem;
    font-size: 0.9rem;
  }

  .form-hint {
    font-size: 0.85rem;
    color: var(--gray);
    margin-top: 0.35rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .form-hint::before {
    content: "💡";
  }

  .progress-bar {
    display: flex;
    justify-content: space-between;
    margin-bottom: 2rem;
    position: relative;
  }

  .progress-bar::before {
    content: "";
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 2px;
    background: var(--gray-light);
    transform: translateY(-50%);
    z-index: 1;
  }

  .progress-step {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    background: var(--white);
    border: 2px solid var(--gray-light);
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    color: var(--gray);
    position: relative;
    z-index: 2;
    transition: var(--transition);
  }

  .progress-step.active {
    border-color: var(--primary);
    background: var(--primary);
    color: var(--white);
    box-shadow: 0 0 0 4px rgba(29, 53, 87, 0.2);
  }

  .progress-step.completed {
    border-color: var(--accent);
    background: var(--accent);
    color: var(--white);
  }

  .step-content {
    display: none;
  }

  .step-content.active {
    display: block;
  }

  .step-navigation {
    display: flex;
    justify-content: space-between;
    margin-top: 2rem;
    grid-column: 1 / -1;
  }

  .btn-secondary {
    background: var(--gray-light);
    color: var(--gray-dark);
    box-shadow: none;
  }

  .btn-secondary:hover {
    background: var(--gray);
    color: var(--white);
  }

  @media (max-width: 480px) {
    .progress-bar {
      margin-bottom: 1.5rem;
    }
    
    .progress-step {
      width: 35px;
      height: 35px;
      font-size: 0.9rem;
    }
    
    .form-header h1 {
      font-size: 1.75rem;
    }
    
    .form-header p {
      font-size: 1rem;
    }
    
    button {
      padding: 0.875rem 1.5rem;
    }
  }
</style>
</head>
<body>
<header>
  <div class="logo">
    <span class="logo-icon">🩸</span>
    <span>Tamil Nadu Blood Donor</span>
  </div>
</header>

<div class="container">
  <div class="form-header">
    <h1>Become a Blood Donor</h1>
    <p>Join our community of lifesavers by registering as a blood donor. Your donation can save up to 3 lives.</p>
  </div>
  
  <div class="progress-bar">
    <div class="progress-step active">1</div>
    <div class="progress-step">2</div>
    <div class="progress-step">3</div>
  </div>
  
  <form id="donorForm">
    <div class="step-content active">
      <div class="form-group">
        <label for="name" class="required">Full Name</label>
        <input id="name" type="text" placeholder="Enter your full name" required />
      </div>
      
      <div class="form-group">
        <label for="dob" class="required">Date of Birth</label>
        <input id="dob" type="date" required />
      </div>
      
      <div class="form-group">
        <label for="gender" class="required">Gender</label>
        <select id="gender" required>
          <option value="">Select Gender</option>
          <option>Male</option>
          <option>Female</option>
          <option>Other</option>
        </select>
      </div>
      
      <div class="form-group">
        <label for="age" class="required">Age</label>
        <input id="age" type="number" placeholder="Age" min="18" max="65" required />
        <div class="form-hint">Must be between 18-65 years</div>
      </div>
    </div>
    
    <div class="step-content">
      <div class="form-group">
        <label for="weight" class="required">Weight (kg)</label>
        <input id="weight" type="number" placeholder="Weight in kilograms" min="45" step="0.1" required />
        <div class="form-hint">Minimum 45 kg required for donation</div>
      </div>
      
      <div class="form-group">
        <label for="phone" class="required">Phone Number</label>
        <input id="phone" type="tel" placeholder="10-digit mobile number" pattern="[0-9]{10}" required />
      </div>
      
      <div class="form-group">
        <label for="bloodGroup" class="required">Blood Group</label>
        <select id="bloodGroup" required>
          <option value="">Select Blood Group</option>
          <option>A+</option><option>A-</option><option>B+</option><option>B-</option>
          <option>AB+</option><option>AB-</option><option>O+</option><option>O-</option>
        </select>
      </div>

      <div class="form-group">
        <label for="location" class="required">District (Tamil Nadu)</label>
        <select id="location" required>
          <option value="">Select District</option>
          <option>Ariyalur</option><option>Chengalpattu</option><option>Chennai</option><option>Coimbatore</option>
          <option>Cuddalore</option><option>Dharmapuri</option><option>Dindigul</option><option>Erode</option>
          <option>Kallakurichi</option><option>Kanchipuram</option><option>Kanyakumari</option><option>Karur</option>
          <option>Krishnagiri</option><option>Madurai</option><option>Mayiladuthurai</option><option>Nagapattinam</option>
          <option>Namakkal</option><option>Nilgiris</option><option>Perambalur</option><option>Pudukkottai</option>
          <option>Ramanathapuram</option><option>Ranipet</option><option>Salem</option><option>Sivaganga</option>
          <option>Tenkasi</option><option>Thanjavur</option><option>Theni</option><option>Thoothukudi</option>
          <option>Tiruchirappalli</option><option>Tirunelveli</option><option>Tirupathur</option><option>Tiruppur</option>
          <option>Tiruvallur</option><option>Tiruvannamalai</option><option>Tiruvarur</option><option>Vellore</option>
          <option>Viluppuram</option><option>Virudhunagar</option>
        </select>
      </div>
    </div>
    
    <div class="step-content">
      <div class="form-group full-width">
        <label for="lastDonate" class="required">Last Donated Date</label>
        <input id="lastDonate" type="date" required />
        <div class="form-hint">If you haven't donated before, enter today's date</div>
      </div>
      
      <div class="form-group full-width">
        <div style="background: #f8f9fa; padding: 1.5rem; border-radius: var(--radius); border-left: 4px solid var(--accent);">
          <h3 style="color: var(--primary); margin-bottom: 0.75rem;">Donation Eligibility</h3>
          <ul style="color: var(--gray); list-style-type: none; padding-left: 0;">
            <li style="margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem;">
              <span>✅</span> <span>You must be in good health and feeling well</span>
            </li>
            <li style="margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem;">
              <span>✅</span> <span>You must be at least 18 years old</span>
            </li>
            <li style="margin-bottom: 0.5rem; display: flex; align-items: flex-start; gap: 0.5rem;">
              <span>✅</span> <span>You must weigh at least 45 kg</span>
            </li>
            <li style="display: flex; align-items: flex-start; gap: 0.5rem;">
              <span>✅</span> <span>You should not have donated blood in the last 3 months</span>
            </li>
          </ul>
        </div>
      </div>
    </div>

    <div class="step-navigation">
      <button type="button" class="btn-secondary" id="prevBtn" style="display: none;">
        <span>←</span> Previous
      </button>
      <button type="button" class="btn-secondary" id="nextBtn">
        Next <span>→</span>
      </button>
    </div>

    <button type="submit" id="submitBtn" style="display: none;">
      <span>🩸</span> Register as Donor
    </button>
  </form>
  
  <div class="links">
    <a href="userview.html">
      <span>🔍</span> View Available Donors
    </a>
  </div>
</div>

<footer>
  <p>Tamil Nadu Blood Donor &copy; 2023 | Saving Lives Together</p>
</footer>

<div id="notification" class="notification">
  <span class="notification-icon">✅</span>
  <span id="notification-message"></span>
</div>

<script>
  // Firebase configuration
  const firebaseConfig = {
    apiKey: "AIzaSyAP-hIC2xJJGu5IWDKnChYaeLowiUZR4b4",
    authDomain: "blood-donate-1b19a.firebaseapp.com",
    databaseURL: "https://blood-donate-1b19a-default-rtdb.firebaseio.com/",
    projectId: "blood-donate-1b19a",
    storageBucket: "blood-donate-1b19a.firebasestorage.app",
    messagingSenderId: "787629339385",
    appId: "1:787629339385:web:4f8bad06864682d1886828",
    measurementId: "G-F9HVYZQ4L9"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  // Form submission handler
  const form = document.getElementById('donorForm');
  const notification = document.getElementById('notification');
  const notificationMessage = document.getElementById('notification-message');
  
  // Multi-step form functionality
  let currentStep = 0;
  const steps = document.querySelectorAll('.step-content');
  const progressSteps = document.querySelectorAll('.progress-step');
  const prevBtn = document.getElementById('prevBtn');
  const nextBtn = document.getElementById('nextBtn');
  const submitBtn = document.getElementById('submitBtn');
  
  function updateFormSteps() {
    steps.forEach((step, index) => {
      step.classList.toggle('active', index === currentStep);
    });
    
    progressSteps.forEach((step, index) => {
      step.classList.toggle('active', index === currentStep);
      step.classList.toggle('completed', index < currentStep);
    });
    
    // Show/hide navigation buttons
    prevBtn.style.display = currentStep === 0 ? 'none' : 'flex';
    nextBtn.style.display = currentStep === steps.length - 1 ? 'none' : 'flex';
    submitBtn.style.display = currentStep === steps.length - 1 ? 'flex' : 'none';
  }
  
  nextBtn.addEventListener('click', () => {
    if (validateStep(currentStep)) {
      currentStep++;
      updateFormSteps();
    }
  });
  
  prevBtn.addEventListener('click', () => {
    currentStep--;
    updateFormSteps();
  });
  
  function validateStep(step) {
    const currentStepEl = steps[step];
    const inputs = currentStepEl.querySelectorAll('input, select');
    
    for (let input of inputs) {
      if (input.hasAttribute('required') && !input.value.trim()) {
        showNotification(`Please fill in the ${input.labels[0].textContent} field`, 'error');
        input.focus();
        return false;
      }
      
      // Specific validations
      if (input.id === 'age' && input.value) {
        const age = parseInt(input.value);
        if (age < 18 || age > 65) {
          showNotification('Age must be between 18 and 65 years', 'error');
          input.focus();
          return false;
        }
      }
      
      if (input.id === 'weight' && input.value) {
        const weight = parseFloat(input.value);
        if (weight < 45) {
          showNotification('Weight must be at least 45 kg', 'error');
          input.focus();
          return false;
        }
      }
      
      if (input.id === 'phone' && input.value) {
        if (!/^\d{10}$/.test(input.value)) {
          showNotification('Please enter a valid 10-digit phone number', 'error');
          input.focus();
          return false;
        }
      }
    }
    
    return true;
  }
  
  // Show notification function
  function showNotification(message, type = 'success') {
    notificationMessage.textContent = message;
    notification.className = `notification ${type}`;
    notification.classList.add('show');
    
    // Update icon based on type
    const icon = notification.querySelector('.notification-icon');
    icon.textContent = type === 'success' ? '✅' : '❌';
    
    setTimeout(() => {
      notification.classList.remove('show');
    }, 5000);
  }

  form.addEventListener('submit', async (ev) => {
    ev.preventDefault();

    // Read form values
    const name = document.getElementById('name').value.trim();
    const dob = document.getElementById('dob').value;
    const gender = document.getElementById('gender').value;
    const age = parseInt(document.getElementById('age').value || '0', 10);
    const weight = parseFloat(document.getElementById('weight').value || '0');
    const phone = document.getElementById('phone').value.trim();
    const bloodGroup = document.getElementById('bloodGroup').value;
    const location = document.getElementById('location').value;
    const lastDonate = document.getElementById('lastDonate').value;

    // Final validation
    if (!name || !dob || !gender || !age || !weight || !phone || !bloodGroup || !location || !lastDonate) {
      showNotification('Please fill all required fields.', 'error');
      return;
    }

    // Age validation
    if (age < 18 || age > 65) {
      showNotification('Age must be between 18 and 65 years.', 'error');
      return;
    }

    // Weight validation
    if (weight < 45) {
      showNotification('Weight must be at least 45 kg.', 'error');
      return;
    }

    // Phone validation
    if (!/^\d{10}$/.test(phone)) {
      showNotification('Please enter a valid 10-digit phone number.', 'error');
      return;
    }

    const donor = { 
      name, 
      dob, 
      gender, 
      age, 
      weight, 
      phone, 
      bloodGroup, 
      location, 
      lastDonate, 
      createdAt: Date.now() 
    };

    try {
      // Show loading state
      submitBtn.textContent = 'Registering...';
      submitBtn.disabled = true;

      await db.ref('donors').push(donor);
      
      showNotification('Thank you for registering as a blood donor! Your information has been saved.', 'success');
      form.reset();
      currentStep = 0;
      updateFormSteps();
      
      // Restore button state
      setTimeout(() => {
        submitBtn.innerHTML = '<span>🩸</span> Register as Donor';
        submitBtn.disabled = false;
      }, 2000);
    } catch (err) {
      console.error('Write error:', err);
      showNotification('Registration failed. Please try again.', 'error');
      
      // Restore button state on error
      submitBtn.innerHTML = '<span>🩸</span> Register as Donor';
      submitBtn.disabled = false;
    }
  });

  // Add some interactivity
  document.addEventListener('DOMContentLoaded', function() {
    // Set minimum date for date of birth (18 years ago)
    const dobInput = document.getElementById('dob');
    const today = new Date();
    const minDate = new Date(today.getFullYear() - 65, today.getMonth(), today.getDate());
    const maxDate = new Date(today.getFullYear() - 18, today.getMonth(), today.getDate());
    dobInput.min = minDate.toISOString().split('T')[0];
    dobInput.max = maxDate.toISOString().split('T')[0];
    
    // Set maximum date for last donation (today)
    const lastDonateInput = document.getElementById('lastDonate');
    lastDonateInput.max = today.toISOString().split('T')[0];
    
    // Auto-calculate age from date of birth
    dobInput.addEventListener('change', function() {
      const birthDate = new Date(this.value);
      const today = new Date();
      let age = today.getFullYear() - birthDate.getFullYear();
      const monthDiff = today.getMonth() - birthDate.getMonth();
      
      if (monthDiff < 0 || (monthDiff === 0 && today.getDate() < birthDate.getDate())) {
        age--;
      }
      
      document.getElementById('age').value = age;
    });
    
    // Initialize form steps
    updateFormSteps();
  });
</script>
</body>
</html>